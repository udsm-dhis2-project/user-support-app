<div class="loading-overlay" *ngIf="savingData">
  <div class="text-center">
    <div>Saving ....</div>
    <div class="mt-3 d-flex justify-content-center w-100">
      <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
    </div>
  </div>
</div>

<ng-container
  *ngIf="{
    messageConversation: messageConversation$ | async,
    dataSetsCategoriesPayload: dataSetsCategoriesPayload$ | async,
    translations: translations$ | async
  } as params"
>
  <h2
    mat-dialog-title
    [ngClass]="{
      rejection: dialogData?.actionType !== 'APPROVE',
      approve: dialogData?.actionType === 'APPROVE'
    }"
  >
    {{
      params?.translations['Reporting Tool Approval'] ||
        'Reporting Tool Approval'
    }}
    - {{ dialogData?.actionType }}
  </h2>
  <mat-dialog-content class="mat-typography">
    <div
      class="approve-container"
      *ngIf="!savingData && !savedData && !missingKey"
    >
      <div
        *ngIf="{
          messageConversation: messageConversation$ | async,
          dataSetsCategoriesPayload: dataSetsCategoriesPayload$ | async
        } as params"
      >
        <mat-progress-bar
          mode="indeterminate"
          *ngIf="
            !params?.messageConversation || !params?.dataSetsCategoriesPayload
          "
        ></mat-progress-bar>
        <div class="w-100" *ngIf="params?.messageConversation">
          <div class="w-100" *ngIf="dataRow?.user">
            From:
            <span class="ml-4">
              From {{ dataRow?.user?.displayName }}
              <span *ngIf="dataRow?.user?.phoneNumber">
                ({{ dataRow?.user?.phoneNumber }})
              </span>
            </span>
          </div>
          <p>
            {{ dialogData?.action }}
          </p>
          <a style="cursor: pointer" (click)="toggleDetails($event)">{{
            viewDetails ? 'View less' : 'View details'
          }}</a>

          <div
            *ngIf="viewDetails"
            class="mt-2"
            [innerHtml]="dialogData?.message?.message"
          ></div>
          <div
            class="w-100 mt-2"
            *ngIf="
              dialogData?.actionType && dialogData?.actionType === 'REJECTED'
            "
          >
            <mat-form-field class="w-100">
              <mat-label>Reason for rejection</mat-label>
              <textarea
                matInput
                [(ngModel)]="reasonForRejection"
                rows="3"
              ></textarea>
            </mat-form-field>
          </div>
          <p
            class="text-warning mt-2"
            *ngIf="reasonForRejection && reasonForRejection.length < 8"
          >
            {{
              params?.translations['Not a valid reason'] || 'Not a valid reason'
            }}
          </p>
          <div mat-dialog-actions class="d-flex justify-content-end">
            <button mat-button (click)="onClose($event)">
              {{ successfullyApproved ? 'Done' : 'Close' }}
            </button>
            <button
              mat-flat-button
              [color]="
                dialogData?.actionType === 'APPROVE' ? 'primary' : 'warn'
              "
              [disabled]="
                successfullyApproved ||
                (dilogData?.actionType === 'REJECTED' &&
                  (!reasonForRejection || reasonForRejection?.length < 8))
              "
              class="ml-2"
              (click)="
                onSave(
                  $event,
                  dialogData,
                  params?.messageConversation,
                  params?.dataSetsCategoriesPayload
                )
              "
            >
              {{ 'Confirm' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="w-100 success-message"
      *ngIf="savedData && !missingKey && dialogData?.actionType === 'APPROVE'"
    >
      <p>
        {{
          params?.translations['Successfully updated'] ||
            'Successfully updated'
        }}!
      </p>
    </div>

    <div
      class="w-100 success-message"
      *ngIf="savedData && !missingKey && dialogData?.actionType === 'REJECTED'"
    >
      <p>
        {{ params?.translations['Successfully sent'] || 'Successfully sent' }}!
      </p>
    </div>

    <div *ngIf="missingKey">
      <p>
        {{ params?.translations['Already attended'] || 'Already attended' }}!
      </p>
    </div>
  </mat-dialog-content>
  <!-- <mat-dialog-actions align="end">
    <button
      mat-button
      (click)="onClose($event)"
      *ngIf="params?.dataStoreInformation && params?.dataStoreInformation?.type"
    >
      {{ 'Cancel' }}
    </button>
    <button
      *ngIf="params?.dataStoreInformation && params?.dataStoreInformation?.type"
      class="ml-2"
      mat-flat-button
      color="primary"
      (click)="onUpdateUser($event, params?.dataStoreInformation)"
    >
      {{ 'Confirm' }}
    </button>
  </mat-dialog-actions> -->
</ng-container>
