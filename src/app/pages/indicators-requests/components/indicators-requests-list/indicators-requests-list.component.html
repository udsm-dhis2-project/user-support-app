<div
  class="w-100"
  *ngIf="{
    indicatorsRequests: indicatorsRequests$ | async,
    translations: translations$ | async
  } as params"
>
  <mat-progress-bar
    mode="indeterminate"
    *ngIf="!params?.indicatorsRequests"
  ></mat-progress-bar>
  <div class="loading-overlay" *ngIf="loading">
    <div class="text-center">
      <ng-container *ngIf="!errorMessage">
        <div>Saving indicator ...</div>
        <div class="mt-3 d-flex justify-content-center w-100">
          <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
        </div>
      </ng-container>
      <ng-container *ngIf="errorMessage">
        <div class="alert alert-warning" role="alert">
          {{ errorMessage }}
          <button
            type="button"
            (click)="onClose($event)"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
      </ng-container>
    </div>
  </div>
  <div class="w-100" style="overflow: auto">
    <!-- {{ params?.indicatorsRequests | json }} -->
    <table class="table table-striped table-bordered mat-elevation-z1">
      <thead>
        <tr>
          <th style="width: 40px">SN</th>
          <th>Request</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="params?.indicatorsRequests?.data?.length > 0">
          <ng-container
            *ngFor="
              let indicatorsRequest of params?.indicatorsRequests?.data;
              let count = index
            "
          >
            <tr>
              <td>{{ count + 1 }}</td>
              <td>{{ indicatorsRequest?.action }}</td>
              <td>
                <button
                  mat-button
                  (click)="onViewDetails($event, indicatorsRequest)"
                >
                  View details
                </button>
              </td>
            </tr>
            <tr *ngIf="detailedRequests[indicatorsRequest?.id]">
              <td></td>
              <td>
                <div
                  [innerHTML]="
                    indicatorsRequest?.message?.htmlMessage
                      ? indicatorsRequest?.message?.htmlMessage
                      : indicatorsRequest?.message?.message
                  "
                ></div>
              </td>
              <td>
                <button
                  mat-flat-button
                  color="primary"
                  *ngIf="
                    currentUser?.keyedAuthorities['ALL'] ||
                    currentUser?.keyedAuthorities[
                      'US_INDICATOR_REQUEST_APPROVE'
                    ]
                  "
                  (click)="onApprove($event, indicatorsRequest)"
                >
                  Approve
                </button>
                <button
                  class="ml-2"
                  mat-flat-button
                  color="warn"
                  *ngIf="
                    currentUser?.keyedAuthorities['ALL'] ||
                    currentUser?.keyedAuthorities[
                      'US_INDICATOR_REQUEST_APPROVE'
                    ]
                  "
                  (click)="onReject($event, indicatorsRequest)"
                >
                  Reject
                </button>
              </td>
            </tr>
          </ng-container>
        </ng-container>
        <ng-container *ngIf="params?.indicatorsRequests?.data?.length === 0">
          <tr>
            <td colspan="100%">
              <div class="alert alert-warning" role="alert">
                There is no indicator request
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
